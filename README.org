#+title: Fuschia
#+description: API Plataforma Digital PEA Pescarte

#+caption: CI
[[https://github.com/cciuenf/fuschia/workflows/elixir_ci/badge.svg?branch=dev]]

Plataforma Digital PEA Pescarte

-----

** Setup

*** GitHub Packages

Antes de subir o ambiente com Docker, é necessário autenticar-se no GitHub Packages. Crie um token acessando
as [[https://github.com/settings/profile][configurações do seu perfil GitHub]] > Developer Settings >
Personal Access Tokens. Para saber quais são as permissões necessárias para o token, leia a
[[https://docs.github.com/pt/packages/learn-github-packages/about-permissions-for-github-packages][documentação]]
sobre o GitHub Packages.

Após criar o token, já é possível fazer a autenticação no GitHub Packages:

#+begin_src sh
echo "<personal_token>" | docker login ghcr.io -u USERNAME --password-stdin 
#+end_src

** Ambiente de desenvolvimento

*** Primeira vez rodando

**** Varáveis de ambiente
Copie o arquivo [[./.env-sample][.env-sample]] para um novo arquivo =.env= e defina os valores necessários
nas variáveis de ambiente.

**** Ferramentas para ambiente local

Este projeto possui três opções para ambientes de desenvolvimento:

1. [[./guides/local/docker.md][Docker]]
2. [[./guides/local/nix.md][Nix]]
3. [[./guides/local/asdf.md][asdf]]

-----

** Guias

- [[./guiides/tests.md][Testes]]
- [[./guides/integration_tests.md][Testes de integração]]

-----

** Aplicações

Esse projeto está dividio em diversas sub-aplicações que possuem diferentes responsabilidades.

#+begin_example
# TODO
#+end_example

*** Fuschia.Mailer

Responsável pelo processamento e envio/disparo dos emails. Estamos utilizando o [[https://github.com/swoosh/swoosh][Swoosh]].

Para testar o preview de email, siga a seguinte documentação:

**** Variáveis de ambiente
Necessárias em produção:
- =MAIL_SERVER=: Server do smtp (default: =smtp.gmail.com=)
- =MAIL_USERNAME=: User do smtp (default: =notificacoes-noreply@peapescarte.uenf.br=)
- =MAIL_PASSWORD=: Senha do smtp
- =MAIL_PORT=: Porta do smtp (default: =587=)
- =MAIL_SERVICE=: O serviço de email a ser usado. Pode ser =gmail= ou =local=.
  (default prod: =gmail=, default dev: =local=)

*Observação*: Em ambiente de desenvolvimento, toda vez que a variável de ambiente =MAIL_SERVICE= é alterada
para trocar o adapter, toda a aplicação deve ser compilada usando

#+begin_src sh
mix compile --force
#+end_src

**** Rodando localmente
Essa aplicação também conta com um servidor para visualizar os emails enviados usando o adaptador local,
basta entrar na aplicação/container e utilizar:

#+begin_src sh
iex -S mix swoosh.mailbox.server
#+end_src

E um servidor no local http://127.0.0.1:4001 vai apresentar uma página web listando os emails
enviados localmente através do =iex= que ficou aberto com o comando anterior.

Caso esteja rodando o servidor com o comando =iex -S mix phx.server=, a caixa de entrada também poderá
ser acessada no endereço http://127.0.0.1/dev/maibox.

-----

** Materiais, Tutoriais, Relatórios e extras

Todo o material do projeto (tanto backend ou frontend) pode ser encontrado no repositório [[https://github.com/cciuenf/documentos_pea_pescarte][documentos_pea_pescarte]], que abriga diversos artigos.
